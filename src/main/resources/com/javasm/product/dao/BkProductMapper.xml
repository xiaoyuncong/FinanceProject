<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.javasm.product.dao.BkProductMapper">
  <resultMap id="BaseResultMap" type="com.javasm.product.bean.BkProduct">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 22:35:03 CST 2022.
    -->
    <id column="product_id" jdbcType="INTEGER" property="productId" />
    <result column="product_name" jdbcType="VARCHAR" property="productName" />
    <result column="product_line_id" jdbcType="INTEGER" property="productLineId" />
    <result column="product_type_id" jdbcType="INTEGER" property="productTypeId" />
    <result column="manage_orgnazition" jdbcType="VARCHAR" property="manageOrgnazition" />
    <result column="open_time" jdbcType="VARCHAR" property="openTime" />
    <result column="currency_type" jdbcType="VARCHAR" property="currencyType" />
    <result column="annual_yield" jdbcType="REAL" property="annualYield" />
    <result column="audit_state" jdbcType="INTEGER" property="auditState" />
    <result column="admin_id" jdbcType="INTEGER" property="adminId" />
    <result column="subscription_cycle" jdbcType="VARCHAR" property="subscriptionCycle" />
    <result column="fund_manage_rates" jdbcType="REAL" property="fundManageRates" />
    <result column="subscription_rates" jdbcType="REAL" property="subscriptionRates" />
    <result column="subscription_start_money" jdbcType="REAL" property="subscriptionStartMoney" />
    <result column="collect_type" jdbcType="INTEGER" property="collectType" />
    <result column="collect_cycle" jdbcType="INTEGER" property="collectCycle" />
    <result column="collect_start_money" jdbcType="REAL" property="collectStartMoney" />
    <result column="collect_money" jdbcType="REAL" property="collectMoney" />
    <result column="lock_period" jdbcType="INTEGER" property="lockPeriod" />
    <result column="ordered" jdbcType="INTEGER" property="ordered" />
    <result column="examine_massage" jdbcType="VARCHAR" property="examineMassage" />
    <result column="product_line_chinese_name" jdbcType="VARCHAR" property="productLineChineseName" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 22:35:03 CST 2022.
    -->
    delete from bk_product
    where product_id = #{productId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.javasm.product.bean.BkProduct">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 22:35:03 CST 2022.
    -->
    insert into bk_product (product_id, product_name, product_line_id, 
      product_type_id, manage_orgnazition, open_time, 
      currency_type, annual_yield, audit_state, 
      admin_id, subscription_cycle, fund_manage_rates, 
      subscription_rates, subscription_start_money, collect_type, 
      collect_cycle, collect_start_money, collect_money, 
      lock_period, examine_massage)
    values (#{productId,jdbcType=INTEGER}, #{productName,jdbcType=VARCHAR}, #{productLineId,jdbcType=INTEGER}, 
      #{productTypeId,jdbcType=INTEGER}, #{manageOrgnazition,jdbcType=VARCHAR}, #{openTime,jdbcType=VARCHAR}, 
      #{currencyType,jdbcType=VARCHAR}, #{annualYield,jdbcType=REAL}, #{auditState,jdbcType=INTEGER}, 
      #{adminId,jdbcType=INTEGER}, #{subscriptionCycle,jdbcType=VARCHAR}, #{fundManageRates,jdbcType=REAL}, 
      #{subscriptionRates,jdbcType=REAL}, #{subscriptionStartMoney,jdbcType=REAL}, #{collectType,jdbcType=INTEGER}, 
      #{collectCycle,jdbcType=INTEGER}, #{collectStartMoney,jdbcType=REAL}, #{collectMoney,jdbcType=REAL}, 
      #{lockPeriod,jdbcType=INTEGER}, #{examineMassage,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.javasm.product.bean.BkProduct">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 22:35:03 CST 2022.
    -->
    update bk_product
    set product_name = #{productName,jdbcType=VARCHAR},
      product_line_id = #{productLineId,jdbcType=INTEGER},
      product_type_id = #{productTypeId,jdbcType=INTEGER},
      manage_orgnazition = #{manageOrgnazition,jdbcType=VARCHAR},
      open_time = #{openTime,jdbcType=VARCHAR},
      currency_type = #{currencyType,jdbcType=VARCHAR},
      annual_yield = #{annualYield,jdbcType=REAL},
      audit_state = #{auditState,jdbcType=INTEGER},
      admin_id = #{adminId,jdbcType=INTEGER},
      subscription_cycle = #{subscriptionCycle,jdbcType=VARCHAR},
      fund_manage_rates = #{fundManageRates,jdbcType=REAL},
      subscription_rates = #{subscriptionRates,jdbcType=REAL},
      subscription_start_money = #{subscriptionStartMoney,jdbcType=REAL},
      collect_type = #{collectType,jdbcType=INTEGER},
      collect_cycle = #{collectCycle,jdbcType=INTEGER},
      collect_start_money = #{collectStartMoney,jdbcType=REAL},
      collect_money = #{collectMoney,jdbcType=REAL},
      lock_period = #{lockPeriod,jdbcType=INTEGER},
      examine_massage = #{examineMassage,jdbcType=VARCHAR}
    where product_id = #{productId,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 22:35:03 CST 2022.
    -->
    select product_id, product_name, product_line_id, product_type_id, manage_orgnazition, 
    open_time, currency_type, annual_yield, audit_state, admin_id, subscription_cycle, 
    fund_manage_rates, subscription_rates, subscription_start_money, collect_type, collect_cycle, 
    collect_start_money, collect_money, lock_period, examine_massage
    from bk_product
    where product_id = #{productId,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 22:35:03 CST 2022.
    -->
    select bp.product_id, product_name, product_line_id, product_type_id, manage_orgnazition,
    open_time, currency_type, annual_yield, audit_state, admin_id, subscription_cycle, 
    fund_manage_rates, subscription_rates, subscription_start_money, collect_type, collect_cycle, 
    collect_start_money, collect_money, lock_period, examine_massage,r.ordered
    from bk_product bp left  join  recommend r on bp.product_id=r.product_id
  </select>
  <select id="queryByConditionForPage" resultMap="BaseResultMap">
    select bp.*,bpl.product_line_chinese_name from bk_product bp left join bk_product_line bpl on bp.product_line_id = bpl.product_line_id
    <where>
      <if test="p.productName!=null and p.productName!=''">
        and product_name like #{p.productName}
      </if>
      <if test="p.auditState !=null and p.auditState!=''">
        and audit_state  = #{p.auditState}
      </if>
      <if test="p.productTypeId!=null and p.productTypeId!=''">
        and product_type_id = #{p.productTypeId}
      </if>
    </where>
    limit #{pageInfo.startIndex},#{pageInfo.pageSize}
  </select>
  <select id="getTotal" resultType="java.lang.Integer">
    select count(*) from bk_product
    <where>
      <if test="p.productName!=null and p.productName!=''">
        and product_name like #{p.productName}
      </if>
      <if test="p.auditState !=null and p.auditState!=''">
        and audit_state  = #{p.auditState}
      </if>
      <if test="p.productTypeId!=null and p.productTypeId!=''">
        and product_type_id = #{p.productTypeId}
      </if>
    </where>
  </select>
  <select id="queryByConditionForPageAndAudit" resultMap="BaseResultMap">
    select bp.*,bpl.product_line_chinese_name from bk_product bp left join bk_product_line bpl on bp.product_line_id = bpl.product_line_id
    <where>
       admin_id = #{adminId}
      <if test="p.productName!=null and p.productName!=''">
        and product_name like #{p.productName}
      </if>
      <if test="p.auditState !=null and p.auditState!=''">
        and audit_state  = #{p.auditState}
      </if>
      <if test="p.productTypeId!=null and p.productTypeId!=''">
        and product_type_id = #{p.productTypeId}
      </if>

    </where>
    limit #{pageInfo.startIndex},#{pageInfo.pageSize}

  </select>
  <select id="getTotalForAudit" resultType="java.lang.Integer">
    select count(*) from bk_product
    <where>
      admin_id = #{adminId}
      <if test="p.productName!=null and p.productName!=''">
        and product_name like #{p.productName}
      </if>
      <if test="p.auditState !=null and p.auditState!=''">
        and audit_state  = #{p.auditState}
      </if>
      <if test="p.productTypeId!=null and p.productTypeId!=''">
        and product_type_id = #{p.productTypeId}
      </if>
    </where>

  </select>
  <select id="selectRelatedIdsByProductId" resultType="integer">
    select product_id from bk_product where product_id
     in (select related_product_id from product_related where product_id=#{productId}) and product_id!=#{productId};
  </select>
  <select id="selectNoRelatedIdsByProductId" resultType="integer">
     select product_id  from bk_product where product_id not
     in (select related_product_id from product_related where product_id=#{productId}) and product_id!=#{productId};
  </select>
</mapper>